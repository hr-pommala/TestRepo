<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoicing Settings Management</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    section { margin-bottom: 30px; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
    h2 { margin-top: 0; }
    label { display: block; margin-top: 8px; }
    input { width: 300px; padding: 5px; margin-top: 2px; }
    button { margin-top: 10px; padding: 5px 15px; }
    #successMessage { color: green; font-weight: bold; margin-top: 10px; }
    #errorMessage { color: red; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
<h1>Invoicing Settings Management</h1>

<!-- CREATE -->
<section id="createSection">
  <h2>Create Invoicing Settings</h2>
  <label>User ID: <input type="text" id="userId"></label>
  <label>Currency: <input type="text" id="currency"></label>
  <label>Tax ID: <input type="text" id="taxId"></label>
  <label>Default Tax Rate: <input type="number" step="0.0001" id="defaultTaxRate"></label>
  <label>Invoice Number Format: <input type="text" id="invoiceNumberFormat"></label>
  <label>Payment Terms Days: <input type="number" id="paymentTermsDays"></label>
  <label>Late Fee Percent: <input type="number" step="0.001" id="lateFeePercent"></label>
  <label>Template ID: <input type="text" id="templateId"></label>
  <label>Logo File ID: <input type="text" id="logoFileId"></label>
  <button id="submitBtn" onclick="createSettings()">Create</button>
  <div id="successMessage"></div>
  <div id="errorMessage"></div>
</section>

<!-- GET -->
<section id="getSection">
  <h2>Get Invoicing Settings</h2>
  <label>User ID: <input type="text" id="getUserId"></label>
  <button onclick="getSettings()">Fetch</button>
  <div id="userIdDisplay"></div>
  <div id="currencyDisplay"></div>
</section>

<!-- UPDATE / PUT -->
<section id="updateSection">
  <h2>Update Invoicing Settings (PUT)</h2>
  <label>User ID: <input type="text" id="updateUserId"></label>
  <label>Currency: <input type="text" id="updateCurrency"></label>
  <label>Tax ID: <input type="text" id="updateTaxId"></label>
  <label>Default Tax Rate: <input type="number" step="0.0001" id="updateDefaultTaxRate"></label>
  <label>Invoice Number Format: <input type="text" id="updateInvoiceNumberFormat"></label>
  <label>Payment Terms Days: <input type="number" id="updatePaymentTermsDays"></label>
  <label>Late Fee Percent: <input type="number" step="0.001" id="updateLateFeePercent"></label>
  <label>Template ID: <input type="text" id="updateTemplateId"></label>
  <label>Logo File ID: <input type="text" id="updateLogoFileId"></label>
  <button onclick="updateSettings()">Update</button>
</section>

<!-- PATCH -->
<section id="patchSection">
  <h2>Patch Invoicing Settings (PATCH)</h2>
  <label>User ID: <input type="text" id="patchUserId"></label>
  <label>Currency: <input type="text" id="patchCurrency"></label>
  <label>Late Fee Percent: <input type="number" step="0.001" id="patchLateFeePercent"></label>
  <button id="patchBtn" onclick="patchSettings()">Patch</button>
</section>

<!-- DELETE -->
<section id="deleteSection">
  <h2>Delete Invoicing Settings</h2>
  <label>User ID: <input type="text" id="deleteUserId"></label>
  <button onclick="deleteSettings()">Delete</button>
</section>

<script>
  const BASE_URL = '/api/v1/settings/invoicing';

  async function createSettings() {
      const payload = {
          userId: document.getElementById('userId').value,
          currency: document.getElementById('currency').value,
          taxId: document.getElementById('taxId').value,
          defaultTaxRate: parseFloat(document.getElementById('defaultTaxRate').value),
          invoiceNumberFormat: document.getElementById('invoiceNumberFormat').value,
          paymentTermsDays: parseInt(document.getElementById('paymentTermsDays').value),
          lateFeePercent: parseFloat(document.getElementById('lateFeePercent').value),
          templateId: document.getElementById('templateId').value,
          logoFileId: document.getElementById('logoFileId').value
      };
      try {
          const response = await fetch(BASE_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
          });
          const data = await response.json();
          document.getElementById('successMessage').innerText = data.message || "Settings created";
          document.getElementById('errorMessage').innerText = '';
      } catch (err) {
          document.getElementById('errorMessage').innerText = err;
      }
  }

  async function getSettings() {
      const userId = document.getElementById('getUserId').value;
      try {
          const response = await fetch(`${BASE_URL}/${userId}`);
          const data = await response.json();
          document.getElementById('userIdDisplay').innerText = 'User ID: ' + (data.data?.userId || 'Not found');
          document.getElementById('currencyDisplay').innerText = 'Currency: ' + (data.data?.currency || '-');
      } catch (err) {
          console.error(err);
      }
  }

  async function updateSettings() {
      const userId = document.getElementById('updateUserId').value;
      const payload = {
          currency: document.getElementById('updateCurrency').value,
          taxId: document.getElementById('updateTaxId').value,
          defaultTaxRate: parseFloat(document.getElementById('updateDefaultTaxRate').value),
          invoiceNumberFormat: document.getElementById('updateInvoiceNumberFormat').value,
          paymentTermsDays: parseInt(document.getElementById('updatePaymentTermsDays').value),
          lateFeePercent: parseFloat(document.getElementById('updateLateFeePercent').value),
          templateId: document.getElementById('updateTemplateId').value,
          logoFileId: document.getElementById('updateLogoFileId').value
      };
      await fetch(`${BASE_URL}/${userId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
      });
      alert('Settings updated successfully');
  }

  async function patchSettings() {
      const userId = document.getElementById('patchUserId').value;
      const payload = {
          currency: document.getElementById('patchCurrency').value || undefined,
          lateFeePercent: parseFloat(document.getElementById('patchLateFeePercent').value) || undefined
      };
      await fetch(`${BASE_URL}/${userId}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
      });
      alert('Settings patched successfully');
  }

  async function deleteSettings() {
      const userId = document.getElementById('deleteUserId').value;
      await fetch(`${BASE_URL}/${userId}`, { method: 'DELETE' });
      alert('Settings deleted successfully');
  }
</script>
</body>
</html>
